# Input CSV Path
$csvPath = "C:\Scripts\dr_records.csv"

# Import records
$records = Import-Csv -Path $csvPath

foreach ($record in $records) {
    $zone = $record.Zone
    $originalName = $record.Name
    $drName = "$originalName-dr"
    $ip = $record.IP

    Write-Host "Processing zone: $zone, original: $originalName, DR IP: $ip"

    # Step 1: Delete Original A Record (if exists)
    $aRecord = Get-DnsServerResourceRecord -ZoneName $zone -Name $originalName -ErrorAction SilentlyContinue | Where-Object { $_.RecordType -eq "A" }
    if ($aRecord) {
        Write-Host "Deleting original A record: $originalName.$zone"
        Remove-DnsServerResourceRecord -ZoneName $zone -RRType "A" -Name $originalName -RecordData $aRecord.RecordData.IPv4Address -Force
    } else {
        Write-Host "No existing A record found for $originalName.$zone"
    }

    # Step 2: Create DR A Record (e.g., abc-dr)
    Write-Host "Creating DR A record: $drName.$zone with IP $ip"
    Add-DnsServerResourceRecordA -Name $drName -ZoneName $zone -IPv4Address $ip

    # Step 3: Create CNAME: original â†’ DR
    Write-Host "Creating CNAME: $originalName -> $drName"
    Add-DnsServerResourceRecordCName -Name $originalName -ZoneName $zone -HostNameAlias "$drName.$zone"
}


dr_records.csv
Name,IP,Zone
abc,10.1.1.101,yash.local
xyz,10.1.1.102,hamed.local
pqr,10.1.1.103,aryaman.local

.\Create-DR-DNSRecords.ps1

