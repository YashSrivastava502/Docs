# ==========================
# Script: Update-DnsARecord.ps1
# ==========================

# Path to CSV file
$csvPath = "C:\scripts\records.csv"

# Import CSV
$records = Import-Csv -Path $csvPath

foreach ($record in $records) {
    $recordName = $record.RecordName
    $newIP = $record.NewIP
    $zoneName = $record.ZoneName

    Write-Host "Processing record: $recordName in zone: $zoneName" -ForegroundColor Cyan

    # Get existing A record
    $existingRecord = Get-DnsServerResourceRecord -ZoneName $zoneName -Name $recordName -ErrorAction SilentlyContinue

    if ($existingRecord -and $existingRecord.RecordType -eq "A") {
        $oldIP = $existingRecord.RecordData.IPv4Address.ToString()
        Write-Host "Existing IP: $oldIP → Updating to: $newIP"

        # Remove old record
        Remove-DnsServerResourceRecord -ZoneName $zoneName -RRType "A" -Name $recordName -RecordData $oldIP -Force

        # Add new record
        Add-DnsServerResourceRecordA -ZoneName $zoneName -Name $recordName -IPv4Address $newIP

        Write-Host "✅ Updated $recordName from $oldIP to $newIP`n" -ForegroundColor Green
    }
    else {
        Write-Host "⚠️ Record not found: $recordName in zone $zoneName" -ForegroundColor Yellow
    }
}

Write-Host "All updates completed!" -ForegroundColor Magenta
