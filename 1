Bilkul Yash! Yahaan ek clear summary hai ki tumne kya kya kiya ab tak — step-by-step, from design to working ETL pipeline.


---

✅ Project Goal

Create a universal ETL script that:

Reads all app_db* databases from DB1 (source)

Syncs them to DB2 (target)

Retains only last 7 days of data

Also handles tables that don’t have date/time column (system_info)



---

🏗️ Infrastructure Setup

You had 3 PostgreSQL servers on Azure:

1. db-test-1: Primary DB with full data


2. db-test-2: Target DB for 7-day data (ETL copy)


3. db-test-3: Future backup/sync server (same ETL logic to be used later)




---

⚙️ Schema in db-test-1

Each app_db* database had 4 tables:

data_events → has timestamp

transactions → has timestamp

activity_logs → has timestamp

system_info → ❌ no timestamp (only id column)



---

🧠 What We Implemented in ETL Script

1. Auto-detect all app_db* databases

SELECT datname FROM pg_database WHERE datistemplate = false;

2. Loop through each table in each DB

Check if table has a time/date column (like created_at, date, etc.)

If yes → pull only rows from last 7 days

If no → use id column and track last synced id via local metadata


3. Maintain local sync tracking in JSON file

File: etl_metadata.json

Tracks last synced id for each non-date-based table


4. Auto-create target database if not exists

Using:

CREATE DATABASE {db}

5. Write synced data to target DB

Using:

df.to_sql(..., if_exists="replace")


---

🛠️ Recent Fixes / Updates

Fixed "not an executable object" by wrapping raw SQL using text() from SQLAlchemy

Fixed missing system_info table issue by adjusting table creation logic

Updated ETL logic to perform full-load once for non-date tables if not synced before



---

📦 Final Result

Now your ETL:

Automatically detects and syncs all 4 tables from each app_db*

Maintains 7-day rolling data

Handles special case of non-date tables smartly

Works universally on any future app_db* without changing the code



---

Let me know if you want:

Backup/sync logic for db-test-3

Cron job setup for daily ETL run

Logging or email alert integration


Great job so far! 🔥
