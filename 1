import pdfplumber
import openpyxl

def pdf_to_excel(pdf_path, excel_path):
    wb = openpyxl.Workbook()
    ws = wb.active
    ws.title = "PDF_Data"

    with pdfplumber.open(pdf_path) as pdf:
        for page_num, page in enumerate(pdf.pages, start=1):
            tables = page.extract_tables()
            if tables:
                for table in tables:
                    for row in table:
                        # Force UTF-8 clean string conversion
                        clean_row = [str(cell).encode("utf-8", "ignore").decode("utf-8") if cell else "" for cell in row]
                        ws.append(clean_row)
            else:
                text = page.extract_text()
                if text:
                    for line in text.split("\n"):
                        clean_line = line.encode("utf-8", "ignore").decode("utf-8")
                        ws.append([clean_line])

    wb.save(excel_path)
    print(f"✅ '{pdf_path}' → '{excel_path}' conversion complete.")

# Example
pdf_to_excel("input.pdf", "output.xlsx")
